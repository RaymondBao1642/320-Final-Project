---
title: "Tutorial"
author: "Vardhan Mehan, Raymond Bao, Chanseok Lee"
date: "5/11/2019"
output: 
  md_document:
    variant: markdown_github
---

# CMSC320 Final Project: 
## *Tutorial on Data Science Pipeline*
## *Impact of GDP on Global Suicide Rates*


## Introduction
Here we analyze if economic indicators can give insight into the well-being of human beings. Specifically, we look at how GDP is correlated with suicide rates on a global level, as well as other factors at play such as age and sex. 

## Dataset 
The dataset we used linked [here](https://www.kaggle.com/russellyates88/suicide-rates-overview-1985-to-2016) pulls from four other datasets linked by time and place, and was built to highlight factors correlated to increased suicide rates among different cohorts globally, across the socio-economic spectrum. 

## Setup
We will be working in RStudio.

Importing libraries: 

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(broom)
library(tidyr)
library(leaflet)
library(maps)
```

Here, we read the csv file we want to use and make a dataframe for it.

```{r read_csv, include=TRUE}
df <- read.csv("master.csv")

df <- df %>%
  mutate(gdp_per_capita = gdp_per_capita....)

countries <- df %>%
  group_by(country) %>%
  summarize(suicides = sum(as.numeric(suicides_no)), population = sum(as.numeric(population)), suicides_per_100k = 100000 * (suicides/population)) %>%
  arrange(desc(suicides_per_100k))

gdp <- df %>%
  group_by(gdp_per_capita) %>%
  summarize(suicides = sum(as.numeric(suicides_no)), population = sum(as.numeric(population)), suicides_per_100k = 100000 * (suicides/population))

time_df <- df %>%
  group_by(year) %>%
  summarize(population = sum(as.numeric(population)), suicides = sum(as.numeric(suicides_no)), suicides_per_100k = 100000* (suicides/population))

sex <- df %>%
  group_by(sex) %>%
  summarize(population = sum(as.numeric(population)), suicides = sum(as.numeric(suicides_no)), suicides_per_100k = 100000*(suicides/population))

head(df)

age_group <- df %>%
  group_by(age) %>%
  summarize(population = sum(as.numeric(population)), suicides = sum(as.numeric(suicides_no)), suicides_per_100k = 100000*(suicides/population))

head(countries) 
  
head(gdp)
head(time_df)
head(sex)
head(age_group)

```

## Data Analysis
We will begin with an initial overview of the data. 

### Suicide Rate by Country

```{r countries, fig.width = 10, fig.height=15, include = TRUE}
countries_plot <- countries %>%
  ggplot(aes(x = factor(country, ordered=TRUE, levels=rev(countries$country)), y = suicides_per_100k, fill=suicides_per_100k)) +
  geom_bar(stat="identity") + 
  coord_flip() +
  scale_y_continuous(breaks=seq(0,45,5)) +
  labs(title = "Country vs Suicides per 100k", x = "Country", y = "Suicides per 100k")

countries_plot
```

Here, we can clearly see that suicide rates clearly differ by country. At the very least, we see that many European countries have high suicide rates. Therefore, we can conclude there is an association between the suicide rate and geographic locations. However, we cannot make any further assumptions on to the causation of suicide rates from this data alone due to the fact that some data may be misrepresented. For example, countries may not be reliable in collecting data on this topic and may have insufficient tools to accurately collect the data. 

### GDP vs Suicide Rate

```{r gdp, include = TRUE}
gdp_plot <- gdp %>%
  ggplot(aes(x = gdp_per_capita, y = suicides_per_100k)) +
  geom_point() +
  geom_smooth() +
  scale_x_continuous(breaks=seq(0,200000,10000)) +
  labs(title = "GDP per Capita vs Suicides per 100k", x = "GDP per Capita", y = "Suicides per 100k")

gdp_plot
```

Here, we see that there are more suicides in countries with lower GDP. It is also important to note that there seem to be more suicides per 100k people in countries with lower GDP than countries with a higher GDP per capita. 

Some issues that we foresee with trying to find a correlation between GDP and suicide rates are the possible inaccuracies of GDP as a measure of the economy. According to Investopedia, GDP doesn't include increases to Standards of Living, Negative Effects on Nature, and Household Production.

GDP calculations inherently undervalues certain products by undermining their contributions to overall productivity and standards of living. For example, a technological breakthrough will increase the standard of living yet GDP will not account for that. GDP calculations also do not take into account negative effects of certain events, such as environmental decay or natural disasters. It also does not account for long term growth, such as sustainable production, clean air, etc. Finally, it doesn't account for people who do not have "market value", such as stay at home moms and free apps and services.

These factors that GDP doesn't account for seems to have an impact on the mental wellbeing of a country's citizens and may therefore not be an accurate predictor of suicide rates. In order to get a better understanding of the impact of GDP on the suicide rate, we need to perform further regression analysis. 


### Global Suicide Rates over Time

```{r time, include = TRUE}
time_plot <- time_df %>%
  ggplot(aes(x = year, y = suicides_per_100k)) +
  geom_point() +
  geom_line() +
  labs(title = "Suicides per 100k over time", x = "Time", y = "Suicides per 100k")

time_plot
```

When analyzing the suicide rates over time, we can see that the suicides rate fluctuate, peaking in 1995. It is possible that certain world events, such as war or poor economy, could have impacted the suicide rates during specific time periods. Note that it is also possible that countries, over time, developed better tools to determine suicide rates, so suicide rates in earlier periods of time may be misrepresented or innacurate. 

From this data alone, we cannot clearly determine if time impacts the suicide rate. 

### Suicide Rates by Gender

```{r sex, include = TRUE}

sex_plot <- sex %>%
  ggplot(aes(x = sex, y = suicides_per_100k, fill=sex)) +
  geom_bar(stat="identity") +
  labs(title = "Gender vs Suicides per 100k", x = "Gender", y = "Suicides per 100k")

sex_plot
```

It is clear to see that males comprise an extremely large portion of global suicide rates. This may be caused by the traditional male role in society and the economy. This clear difference in suicide rates between male and females should be taken into account when we create our regression model for predicting suicide rates.

### Suicide rates by Gender in each Country

```{r sex_country, fig.width=10, fig.height=15, include=TRUE}
sex_country <- df %>%
  group_by(country, sex) %>%
  summarize(population = sum(as.numeric(population)), suicides = sum(as.numeric(suicides_no)), suicides_per_100k = 100000 * (suicides/population)) %>%
  arrange(desc(suicides))

gender_country_plot <- sex_country %>%
  ggplot(aes(x = factor(country, ordered=TRUE, levels=rev(countries$country)), y = suicides_per_100k, fill = sex)) +
  geom_bar(stat = "Identity") +
  coord_flip() +
  labs(title="Suicide per 100k for each Gender in each Country", x="Country", y="Suicides per 100k")
 
gender_country_plot 
```

We see that in each country, there is a large difference between the number of men committing suicide vs the number of women committing suicide. We saw this difference in the global suicides of men vs women. This shows that most countries, although different in economic prosperity, GDP, and location, have a similar ratio of suicide rates between men and women, further backing the need to include gender differences into our regression model.

### Suicide Rates by Age Group

```{r age, include = TRUE}
age_group_plot <- age_group %>%
  ggplot(aes(x = factor(age, ordered=TRUE, levels=c("5-14 years","15-24 years","25-34 years","35-54 years","55-74 years","75+ years")), y= suicides_per_100k, fill=age)) +
  geom_bar(stat="identity") +
  labs(title = "Age Group vs Suicides per 100k", x = "Age group", y = "Suicides per 100k")

age_group_plot
```

There is a clear trend with age and suicide rates. Similar to sex, this may be due to environmental and societal pressures that may grow over time. For example, the average suicide rates for people in the work force (roughly between the ages of 25 and 75) are relatively high and increase with age. For the 75+ category, it is important to note that the definition of suicide may differ from country to country, so it possible that deaths due to euthanasia and assisted suicide (from doctors) may be added to this count. 

```{r age_country, fig.width=10, fig.height=15, include=TRUE}
age_country <- df %>%
  group_by(country, age) %>%
  summarize(population = sum(as.numeric(population)), suicides = sum(as.numeric(suicides_no)), suicides_per_100k = 100000 * (suicides/population)) %>%
  arrange(desc(suicides))

age_country_plot <- age_country %>%
  ggplot(aes(x = factor(country, ordered=TRUE, levels=rev(countries$country)), y = suicides_per_100k, fill = age)) +
  geom_bar(stat="Identity") +
  coord_flip()

age_country_plot
```





